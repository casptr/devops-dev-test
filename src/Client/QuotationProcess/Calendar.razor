@page "/aanvraag/datum-kiezen"
@using Foodtruck.Client.QuotationProcess.Components
@using Foodtruck.Client.QuotationProcess.Helpers;
@using Foodtruck.Shared.Reservations;

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-2">
    <QuotationProcessTimeline currentStep="QuotationProcessStep.CHOOSE_DATE" />
    <MudStack Spacing="10" AlignItems="AlignItems.Center">
        <MudText Typo="Typo.h4" Align="Align.Center">
            Selecteer een datum
        </MudText>

        <MudStack Spacing="5" AlignItems="AlignItems.Center" Style="width:fit-content">
            <MudText Align="Align.Center" Class="d-flex gap-1">
                <MudIcon Icon="@Icons.Material.Outlined.Info" Size="Size.Small" Color="Color.Info" />
                @(!startDateConfirmed ? "Gelieve een leverdatum te selecteren." : "Wanneer mag de truck opgehaald worden?")
            </MudText>

            <MudStack Spacing="0">
                <MudCard Elevation="1" Class="calender-card pa-5" >
                    <MudStack AlignItems="AlignItems.Center" Spacing="1">
                        <MudStack Row AlignItems="AlignItems.Center">
                             <MudText Style="@ChipStyle(!startDateConfirmed)">
                                 Levering op
                             </MudText>

                             <MudChip Size="Size.Large" Color="Color.Primary" Variant="@ChipVariant(!startDateConfirmed)"
                                      OnClick="@EditStartDate" Style="@ChipStyle(!startDateConfirmed)">
                                 @(startDate is null ? "/" : "📅 " + startDate?.ToString("dd / MM / yyyy"))
                            </MudChip>

                            <MudText Style="@ChipStyle(startDateConfirmed)">
                                Ophaling op
                            </MudText>

                            <MudChip Size="Size.Large" Color="Color.Primary" Variant="@ChipVariant(startDateConfirmed)">
                                @(endDate is null ? "/" : "📅 " + endDate?.ToString("dd / MM / yyyy"))
                            </MudChip>
                        </MudStack>
                    </MudStack>
                </MudCard>

                @if (!startDateConfirmed)
                {
                    <MudDatePicker PickerVariant="PickerVariant.Static" FirstDayOfWeek="DayOfWeek.Monday" DisplayMonths="2" DisableToolbar Elevation="1"
                                    DateChanged="SetStartDate" IsDateDisabledFunc="IsDateAlreadyBooked" />
                }

                @if (startDateConfirmed)
                {
                    <MudDatePicker PickerVariant="PickerVariant.Static" FirstDayOfWeek="DayOfWeek.Monday" DisplayMonths="2" DisableToolbar Elevation="1" PickerMonth="@PickerMonth"
                                    DateChanged="SetEndDate" IsDateDisabledFunc="IsDateAvailableAsEnd" AdditionalDateClassesFunc="AdditionalDateClassesFunc" />
                }

            </MudStack>

            <MudText Class="mr-auto" Typo="Typo.body2">
                De truck wordt telkens om 11:00 geleverd en om 16:00 opgehaald
            </MudText>

            <MudStack Row Style="width:100%;">
                 @if (!startDateConfirmed)
                {
                    <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto"
                               OnClick="@(ConfirmStartDate)" Disabled="@(startDate is null)">
                        Leverdatum bevestigen
                    </MudButton>
                }

                @if (startDateConfirmed)
                {
                    <MudButton Variant="Variant.Outlined" OnClick="@EditStartDate">
                        Leverdatum aanpassen
                    </MudButton>

                    <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto"
                               OnClick="@(Submit)" Disabled="@(endDate is null)">
                        Doorgaan
                    </MudButton>
                }
            </MudStack>
        </MudStack>
    </MudStack>
</MudContainer>